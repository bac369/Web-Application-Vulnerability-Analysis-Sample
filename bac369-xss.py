import re, requests
import time
with requests.Session() as s:

    get_token = s.get("http://127.0.0.1:8989/login.html")
    csrf_token = re.search("csrfmiddlewaretoken\" value=\"(.*)?\"", get_token.text).group(1)
    url = "http://127.0.0.1:8989/login.html"
    values = {
        "uname" : "LEGITLOGIN",
        "pword" : "PASSWORD",
        "csrfmiddlewaretoken" : csrf_token

    }
    req = s.post(url,data=values, allow_redirects = False)
    print (req.text)
    #print (s.cookies.values())
    for cookie in s.cookies:
        cookie.secure = False
    url = "http://127.0.0.1:8989/gift.html"
    get_token = s.get("http://127.0.0.1:8989/gift.html")
    csrf_token = re.search("csrfmiddlewaretoken\" value=\"(.*)?\"", get_token.text).group(1)
    values = {

        "amount" : 95,
        "username" : "this acc <script> alert(VULNERABLE)</script>",
        "csrfmiddlewaretoken" : csrf_token,

    }
    req = s.post(url,data=values)
    result = req.text
    word = "<script>"
    print (req.text)
    if word in result:
        print('VULNERABLE to XSS!')
    else:
        print('NOT VULNERABLE to XSS!')


    # print (req.headers)
    # print (req.cookies)
    #print (req.text)
    #req = s.get('http://127.0.0.1/gift/0')
    #print
